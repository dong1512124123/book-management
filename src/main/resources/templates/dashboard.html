<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{fragments/header :: styles}">
    <title>LibraryGO - 현황</title>
</head>
<body>
    <!-- 상단 네비게이션 -->
    <nav th:replace="~{fragments/header :: navbar}"></nav>
    <div th:replace="~{fragments/header :: sidebar}"></div>

    <div class="main-content">
    <div class="container-fluid">
        <!-- 페이지 헤더 -->
        <div class="page-header d-flex justify-content-between align-items-center">
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-1">
                        <li class="breadcrumb-item">홈</li>
                        <li class="breadcrumb-item active">현황</li>
                    </ol>
                </nav>
                <h2 class="mb-0">현황</h2>
                <p class="text-muted mb-0">도서관 운영 현황을 한눈에 확인하세요</p>
            </div>
            <a href="/loans/new" class="btn btn-primary">
                <i class="bi bi-plus-lg me-1"></i> 대출 처리
            </a>
        </div>

        <!-- 통계 카드 4개 -->
        <div class="row g-4 mb-4">
            <!-- 전체 도서 수 -->
            <div class="col-lg-3 col-md-6">
                <a href="/books" class="text-decoration-none">
                <div class="card stat-card" style="border-left-color: #6366f1; cursor:pointer;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-number" th:text="${totalBooks}">0</div>
                            <div class="stat-label">전체 도서 수</div>
                        </div>
                        <div class="stat-icon" style="background-color: #eef2ff; color: #6366f1;">
                            <i class="bi bi-book-half"></i>
                        </div>
                    </div>
                </div>
                </a>
            </div>
            <!-- 등록 회원 수 -->
            <div class="col-lg-3 col-md-6">
                <a href="/members" class="text-decoration-none">
                <div class="card stat-card" style="border-left-color: #f59e0b; cursor:pointer;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-number" th:text="${totalMembers}">0</div>
                            <div class="stat-label">등록 회원 수</div>
                        </div>
                        <div class="stat-icon" style="background-color: #fef3c7; color: #f59e0b;">
                            <i class="bi bi-people-fill"></i>
                        </div>
                    </div>
                </div>
                </a>
            </div>
            <!-- 현재 대출 중 -->
            <div class="col-lg-3 col-md-6">
                <a href="/loans" class="text-decoration-none">
                <div class="card stat-card" style="border-left-color: #ef4444; cursor:pointer;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-number" th:text="${activeLoans}">0</div>
                            <div class="stat-label">현재 대출 중</div>
                        </div>
                        <div class="stat-icon" style="background-color: #fee2e2; color: #ef4444;">
                            <i class="bi bi-box-arrow-right"></i>
                        </div>
                    </div>
                </div>
                </a>
            </div>
            <!-- 대출 가능 도서 -->
            <div class="col-lg-3 col-md-6">
                <a href="/books" class="text-decoration-none">
                <div class="card stat-card" style="border-left-color: #22c55e; cursor:pointer;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-number" th:text="${availableBooks}">0</div>
                            <div class="stat-label">대출 가능 도서</div>
                        </div>
                        <div class="stat-icon" style="background-color: #dcfce7; color: #22c55e;">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                    </div>
                </div>
                </a>
            </div>
        </div>

        <!-- 대기 중인 요청 알림 -->
        <div class="row g-3 mb-4" th:if="${pendingCount > 0 || returnRequestCount > 0}">
            <div class="col-md-6" th:if="${pendingCount > 0}">
                <div class="alert alert-warning d-flex align-items-center mb-0" role="alert">
                    <i class="bi bi-clock-fill me-2 fs-5"></i>
                    <div>
                        <strong>승인 대기</strong> -
                        <span th:text="${pendingCount}"></span>건의 대출 신청이 승인을 기다리고 있습니다.
                        <a href="/loans?status=REQUESTED" class="alert-link ms-2">확인하기 →</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6" th:if="${returnRequestCount > 0}">
                <div class="alert alert-info d-flex align-items-center mb-0" role="alert">
                    <i class="bi bi-arrow-return-left me-2 fs-5"></i>
                    <div>
                        <strong>반납 대기</strong> -
                        <span th:text="${returnRequestCount}"></span>건의 반납 요청이 확인을 기다리고 있습니다.
                        <a href="/loans?status=RETURN_REQUESTED" class="alert-link ms-2">확인하기 →</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 현재 대출 현황 -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-clipboard-data me-2" style="color: var(--primary-color);"></i>
                    현재 대출 현황
                </h5>
                <a href="/loans" class="btn btn-sm btn-outline-primary">전체 보기 →</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>도서명</th>
                                <th>저자</th>
                                <th>출판사</th>
                                <th>회원명</th>
                                <th>대출일</th>
                                <th>반납기한</th>
                                <th>상태</th>
                                <th style="width: 100px">처리</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="loan : ${recentLoans}">
                                <td>
                                    <a th:href="@{/books/{id}(id=${loan.book.id}, from='dashboard')}"
                                       class="text-decoration-none fw-bold" th:text="${loan.book.title}"></a>
                                </td>
                                <td th:text="${loan.book.author}"></td>
                                <td th:text="${loan.book.publisher}"></td>
                                <td th:text="${loan.member.name}"></td>
                                <td th:text="${loan.borrowDate}"></td>
                                <td th:text="${loan.returnDueDate}"></td>
                                <td>
                                    <span th:if="${loan.overdue}" class="badge badge-overdue">
                                        <i class="bi bi-exclamation-circle me-1"></i>연체
                                    </span>
                                    <span th:unless="${loan.overdue}" class="badge badge-borrowed">
                                        <i class="bi bi-circle-fill me-1" style="font-size:0.5rem"></i>대출 중
                                    </span>
                                </td>
                                <td>
                                    <form th:action="@{/loans/{id}/return(id=${loan.id})}" method="post" style="display:inline">
                                        <button type="submit" class="btn btn-sm btn-primary"
                                                onclick="return confirm('반납 처리하시겠습니까?')">반납</button>
                                    </form>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(recentLoans)}">
                                <td colspan="8" class="text-center text-muted py-4">
                                    현재 대출 중인 도서가 없습니다.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 바로가기 카드 2개 -->
        <div class="row g-4 mb-4">
            <!-- 도서 관리 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body text-center py-4">
                        <h5 class="mb-3">
                            <i class="bi bi-journal-bookmark-fill me-2" style="color: var(--primary-color);"></i>
                            도서 관리
                        </h5>
                        <p class="text-muted mb-3">새 도서를 시스템에 등록합니다</p>
                        <a href="/books/new" class="btn btn-primary">도서 등록하기</a>
                    </div>
                </div>
            </div>
            <!-- 회원 관리 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body text-center py-4">
                        <h5 class="mb-3">
                            <i class="bi bi-people-fill me-2" style="color: #f59e0b;"></i>
                            회원 관리
                        </h5>
                        <p class="text-muted mb-3">새 회원을 시스템에 등록합니다</p>
                        <a href="/members/new" class="btn btn-primary">회원 등록하기</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
